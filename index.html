<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Examen de Razonamiento Cuantitativo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f0f4f8;
    }

    .container {
        background: white;
        padding: 25px;
        border-radius: 15px;
        max-width: 800px;
        margin: auto;
        box-shadow: 0px 0px 10px rgba(0,0,0,0.15);
    }

    h1, h2 {
        text-align: center;
        color: #003366;
    }

    label {
        font-weight: bold;
    }

    input[type="text"], input[type="file"], select {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        margin-bottom: 15px;
        border-radius: 8px;
        border: 1px solid #bbb;
    }

    button {
        width: 100%;
        padding: 15px;
        background: #0059b3;
        border: none;
        color: white;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
    }

    button:hover {
        background: #004080;
    }

    .timer {
        text-align: center;
        font-size: 22px;
        padding: 10px;
        background: #003366;
        color: white;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .pregunta {
        background: #eef5ff;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 10px;
    }

</style>
</head>

<body oncontextmenu="return false">
<div class="container">

<h1>Examen Virtual</h1>
<div class="timer" id="timer">Tiempo restante: 45:00</div>

<form id="examenForm" enctype="multipart/form-data">

<h2>Datos del estudiante</h2>

<label>Nombre completo:</label>
<input type="text" id="nombre" name="nombre" required>

<label>Documento:</label>
<input type="text" id="documento" name="documento" required>

<hr>

<h2>Preguntas</h2>

<div class="pregunta">
    <label>1. Â¿CuÃ¡l es el valor de Ï€?</label><br>
    <input type="radio" name="p1" value="3.14" required> 3.14<br>
    <input type="radio" name="p1" value="3.16"> 3.16<br>
    <input type="radio" name="p1" value="3.10"> 3.10<br>
</div>

<div class="pregunta">
    <label>2. Un terreno mide 30 m por 20 m. Â¿CuÃ¡l es su Ã¡rea?</label><br>
    <input type="radio" name="p2" value="400"> 400 mÂ²<br>
    <input type="radio" name="p2" value="600" required> 600 mÂ²<br>
    <input type="radio" name="p2" value="900"> 900 mÂ²<br>
</div>

<div class="pregunta">
    <label>3. Â¿CuÃ¡l es la razÃ³n equivalente a 2:4?</label><br>
    <input type="radio" name="p3" value="1:2" required> 1:2<br>
    <input type="radio" name="p3" value="2:6"> 2:6<br>
    <input type="radio" name="p3" value="4:2"> 4:2<br>
</div>

<div class="pregunta">
    <label>4. Si 3 kg cuestan $12.000, Â¿cuÃ¡nto cuestan 5 kg?</label><br>
    <input type="radio" name="p4" value="15000" required> $15.000<br>
    <input type="radio" name="p4" value="18000"> $18.000<br>
    <input type="radio" name="p4" value="20000"> $20.000<br>
</div>

<div class="pregunta">
    <label>5. Â¿CuÃ¡l de los siguientes es un nÃºmero irracional?</label><br>
    <input type="radio" name="p5" value="âˆš2" required> âˆš2<br>
    <input type="radio" name="p5" value="5.25"> 5.25<br>
    <input type="radio" name="p5" value="7/3"> 7/3<br>
</div>


<h2>Evidencia del procedimiento</h2>

<label>Sube la foto del desarrollo de tus ejercicios (obligatorio):</label>
<input type="file" name="foto" accept="image/*" required>

<br><br>
<button type="submit">Enviar examen</button>

</form>

</div>

<!-- ===========================
   ðŸ”µ Supabase Backend
=========================== -->
<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

const supabaseUrl = "TU_URL_SUPABASE";
const supabaseKey = "TU_API_KEY_AQUÃ";
const supabase = createClient(supabaseUrl, supabaseKey);

// Guardar hora de inicio
const horaInicio = new Date().toISOString();

// Temporizador (45 minutos)
let tiempo = 45 * 60;
const timerElement = document.getElementById("timer");

setInterval(() => {
    let min = Math.floor(tiempo / 60);
    let sec = tiempo % 60;
    timerElement.textContent = `Tiempo restante: ${min}:${sec < 10 ? '0'+sec : sec}`;
    tiempo--;

    if(tiempo <= 0){
        alert("Tiempo finalizado. Se enviarÃ¡ tu examen automÃ¡ticamente.");
        document.getElementById("examenForm").dispatchEvent(new Event("submit"));
    }

}, 1000);


// EnvÃ­o del examen
document.getElementById("examenForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const horaFin = new Date().toISOString();
    const form = new FormData(document.getElementById("examenForm"));

    const nombre = form.get("nombre");
    const documento = form.get("documento");

    // Respuestas
    const respuestas = {};
    form.forEach((value, key) => {
        if (key !== "foto") respuestas[key] = value;
    });

    // Subir foto
    const foto = form.get("foto");
    const fileName = `${documento}_${Date.now()}.jpg`;

    const { data: file, error: uploadError } = await supabase.storage
        .from("evidencias")
        .upload(fileName, foto);

    if (uploadError) {
        alert("Error al subir foto: " + uploadError.message);
        return;
    }

    const fotoUrl = supabase.storage
        .from("evidencias")
        .getPublicUrl(fileName).data.publicUrl;

    // Guardar datos
    const { error: insertError } = await supabase
        .from("examen_respuestas")
        .insert({
            nombre,
            documento,
            respuestas,
            hora_inicio: horaInicio,
            hora_fin: horaFin,
            foto_url: fotoUrl
        });

    if (insertError) {
        alert("Error al enviar: " + insertError.message);
        return;
    }

    alert("âœ” Examen enviado exitosamente.");
    location.reload();

});
</script>

</body>
</html>
